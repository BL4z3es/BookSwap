<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up | BookSwap</title>
    <meta name="description" content="Create your BookSwap account - Join the community to find and share school books.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#0d9488;--primary-light:#14b8a6;--primary-dark:#0f766e;--accent:#f59e0b;--bg-dark:#0f172a;--bg-card:#1e293b;--bg-input:#334155;--text-primary:#f8fafc;--text-secondary:#94a3b8;--text-muted:#64748b;--border:#475569;--error:#ef4444;--success:#22c55e}
        body{font-family:'Inter',sans-serif;background:var(--bg-dark);min-height:100vh;display:flex;overflow-x:hidden}
        .bg-animation{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;overflow:hidden}
        .bg-animation::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 80% 80%,rgba(13,148,136,0.15) 0%,transparent 50%),radial-gradient(circle at 20% 20%,rgba(245,158,11,0.1) 0%,transparent 50%),radial-gradient(circle at 60% 40%,rgba(13,148,136,0.08) 0%,transparent 40%);animation:bgFloat 20s ease-in-out infinite reverse}
        @keyframes bgFloat{0%,100%{transform:translate(0,0) rotate(0deg)}33%{transform:translate(2%,2%) rotate(1deg)}66%{transform:translate(-1%,1%) rotate(-1deg)}}
        .floating-shapes{position:absolute;width:100%;height:100%}
        .shape{position:absolute;border-radius:50%;opacity:0.1;animation:float 15s ease-in-out infinite}
        .shape-1{width:350px;height:350px;background:linear-gradient(135deg,var(--primary),var(--primary-light));bottom:10%;right:5%;animation-delay:-2s}
        .shape-2{width:180px;height:180px;background:linear-gradient(135deg,var(--accent),#fbbf24);top:15%;left:10%;animation-delay:-7s}
        .shape-3{width:120px;height:120px;background:linear-gradient(135deg,var(--primary-dark),var(--primary));top:50%;right:20%;animation-delay:-12s}
        @keyframes float{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-30px) scale(1.05)}}
        .form-panel{width:100%;max-width:520px;display:flex;align-items:center;justify-content:center;padding:2rem;position:relative;z-index:1}
        .form-container{width:100%;max-width:420px;background:var(--bg-card);border-radius:24px;padding:2.5rem;border:1px solid var(--border);box-shadow:0 25px 50px -12px rgba(0,0,0,0.5),0 0 0 1px rgba(255,255,255,0.05);backdrop-filter:blur(10px)}
        .form-header{text-align:center;margin-bottom:2rem}
        .form-header h1{font-family:'Space Grotesk',sans-serif;font-size:1.75rem;font-weight:600;color:var(--text-primary);margin-bottom:0.5rem}
        .form-header p{color:var(--text-secondary);font-size:0.95rem}
        .form-header p a{color:var(--primary);text-decoration:none;font-weight:500;transition:color 0.2s}
        .form-header p a:hover{color:var(--primary-light)}
        .form-row{display:flex;gap:1rem}
        .form-group{margin-bottom:1.25rem;flex:1}
        .form-label{display:block;font-size:0.875rem;font-weight:500;color:var(--text-secondary);margin-bottom:0.5rem}
        .input-wrapper{position:relative}
        .input-wrapper svg.input-icon{position:absolute;left:1rem;top:50%;transform:translateY(-50%);width:20px;height:20px;color:var(--text-muted);transition:color 0.2s;pointer-events:none}
        .form-input{width:100%;padding:0.875rem 1rem;background:var(--bg-input);border:2px solid transparent;border-radius:12px;font-size:1rem;color:var(--text-primary);transition:all 0.2s}
        .form-input.with-icon{padding-left:3rem}
        .form-input::placeholder{color:var(--text-muted)}
        .form-input:focus{outline:none;border-color:var(--primary);background:var(--bg-dark)}
        .form-input:focus~svg.input-icon{color:var(--primary)}
        .password-toggle{position:absolute;right:1rem;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--text-muted);padding:0.25rem;display:flex;transition:color 0.2s}
        .password-toggle:hover{color:var(--text-secondary)}
        .password-toggle svg{width:20px;height:20px}
        .password-strength{margin-top:0.5rem}
        .strength-bar{display:flex;gap:4px;margin-bottom:0.25rem}
        .strength-segment{flex:1;height:4px;background:var(--bg-input);border-radius:2px;transition:background 0.3s}
        .strength-segment.active.weak{background:var(--error)}
        .strength-segment.active.medium{background:var(--accent)}
        .strength-segment.active.strong{background:var(--success)}
        .strength-text{font-size:0.75rem;color:var(--text-muted)}
        .terms-checkbox{display:flex;align-items:flex-start;gap:0.75rem;margin-bottom:1.5rem}
        .terms-checkbox input{width:20px;height:20px;accent-color:var(--primary);cursor:pointer;margin-top:2px;flex-shrink:0}
        .terms-checkbox label{font-size:0.875rem;color:var(--text-secondary);line-height:1.5}
        .terms-checkbox a{color:var(--primary);text-decoration:none;font-weight:500}
        .terms-checkbox a:hover{color:var(--primary-light)}
        .btn-primary{width:100%;padding:1rem;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:12px;font-size:1rem;font-weight:600;color:white;cursor:pointer;transition:all 0.3s;position:relative;overflow:hidden}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 30px -10px rgba(13,148,136,0.5)}
        .btn-primary:active{transform:translateY(0)}
        .divider{display:flex;align-items:center;margin:1.5rem 0;gap:1rem}
        .divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
        .divider span{font-size:0.875rem;color:var(--text-muted)}
        .social-buttons{display:flex;gap:0.75rem}
        .btn-social{flex:1;display:flex;align-items:center;justify-content:center;gap:0.5rem;padding:0.875rem;background:var(--bg-input);border:2px solid var(--border);border-radius:12px;font-size:0.875rem;font-weight:500;color:var(--text-primary);cursor:pointer;transition:all 0.2s}
        .btn-social:hover{border-color:var(--primary);background:var(--bg-dark)}
        .btn-social svg{width:20px;height:20px}
        .brand-panel{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:3rem;position:relative;z-index:1}
        .brand-content{max-width:480px;text-align:center}
        .brand-logo{display:flex;align-items:center;justify-content:center;gap:0.75rem;margin-bottom:2rem}
        .brand-logo svg{width:48px;height:48px;color:var(--primary)}
        .brand-logo span{font-family:'Space Grotesk',sans-serif;font-size:2rem;font-weight:700;color:var(--text-primary)}
        .brand-tagline{font-family:'Space Grotesk',sans-serif;font-size:2.5rem;font-weight:600;color:var(--text-primary);line-height:1.2;margin-bottom:1.5rem}
        .brand-tagline span{background:linear-gradient(135deg,var(--primary),var(--primary-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .brand-description{font-size:1.125rem;color:var(--text-secondary);line-height:1.7;margin-bottom:2.5rem}
        .features-list{text-align:left;display:flex;flex-direction:column;gap:1rem}
        .feature-item{display:flex;align-items:center;gap:1rem;padding:1rem;background:rgba(13,148,136,0.1);border-radius:12px;border:1px solid rgba(13,148,136,0.2)}
        .feature-icon{width:40px;height:40px;display:flex;align-items:center;justify-content:center;background:var(--primary);border-radius:10px;flex-shrink:0}
        .feature-icon svg{width:20px;height:20px;color:white}
        .feature-text h4{font-family:'Space Grotesk',sans-serif;font-size:1rem;font-weight:600;color:var(--text-primary);margin-bottom:0.25rem}
        .feature-text p{font-size:0.875rem;color:var(--text-secondary)}
        .custom-toast-container{position:fixed;top:1.5rem;right:1.5rem;z-index:9999;display:flex;flex-direction:column;gap:0.75rem;pointer-events:none}
        .custom-toast{display:flex;align-items:center;gap:0.75rem;padding:1rem 1.25rem;background:var(--bg-card);border:1px solid var(--border);border-radius:12px;box-shadow:0 10px 40px -10px rgba(0,0,0,0.5);animation:slideIn 0.3s ease;pointer-events:auto}
        .custom-toast.success{border-left:4px solid var(--success)}
        .custom-toast.error{border-left:4px solid var(--accent)}
        .custom-toast.critical{border-left:4px solid var(--error)}
        .custom-toast-icon{width:24px;height:24px;flex-shrink:0}
        .custom-toast.success .custom-toast-icon{color:var(--success)}
        .custom-toast.error .custom-toast-icon{color:var(--accent)}
        .custom-toast.critical .custom-toast-icon{color:var(--error)}
        .custom-toast-message{font-size:0.9rem;color:var(--text-primary)}
        @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
        .btn-loading{pointer-events:none;opacity:0.8}
        .btn-loading .btn-text{visibility:hidden}
        .btn-loading::after{content:'';position:absolute;width:20px;height:20px;border:2px solid transparent;border-top-color:white;border-radius:50%;animation:spin 0.8s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        @media(max-width:1024px){.brand-panel{display:none}.form-panel{max-width:100%}body{justify-content:center}}
        @media(max-width:480px){.form-container{padding:1.5rem;border-radius:20px}.form-header h1{font-size:1.5rem}.form-row{flex-direction:column;gap:0}.social-buttons{flex-direction:column}}
    </style>
</head>
<body>
    <div class="bg-animation"><div class="floating-shapes"><div class="shape shape-1"></div><div class="shape shape-2"></div><div class="shape shape-3"></div></div></div>
    <div class="form-panel"><div class="form-container">
        <div class="form-header">
            <h1>Create your account</h1>
            <p>Already have an account? <a href="{% url 'login' %}">Sign in</a></p>
        </div>

        <form id="signupForm" method="post" action="{% url 'register' %}" novalidate>
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="firstName">First name</label>
                    <div class="input-wrapper">
                        <input type="text" id="firstName" name="first_name" class="form-input" placeholder="John" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="lastName">Last name</label>
                    <div class="input-wrapper">
                        <input type="text" id="lastName" name="last_name" class="form-input" placeholder="Doe" required>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="grade">Grade</label>
                    <div class="input-wrapper">
                        <select id="grade" name="grade" class="form-input" required>
                            <option value="" disabled selected>Select grade</option>
                            <option value="0">Prep</option>
                            <option value="9">Grade 9</option>
                            <option value="10">Grade 10</option>
                            <option value="11">Grade 11</option>
                            <option value="12">Grade 12</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="gradYear">Graduation Year</label>
                    <div class="input-wrapper">
                        <input type="number" id="gradYear" name="gradyear" class="form-input" placeholder="2025" min="2024" max="2035" required>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="email">Email address</label>
                <div class="input-wrapper">
                    <input type="email" id="email" name="email" class="form-input with-icon" placeholder="john@example.com" required>
                    <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="password">Password</label>
                <div class="input-wrapper">
                    <input type="password" id="password" name="password" class="form-input with-icon" placeholder="Create a strong password" required>
                    <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                    <button type="button" class="password-toggle" onclick="togglePassword()">
                        <svg id="eyeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
                <div class="password-strength" id="passwordStrength" style="display:none">
                    <div class="strength-bar">
                        <div class="strength-segment" id="seg1"></div>
                        <div class="strength-segment" id="seg2"></div>
                        <div class="strength-segment" id="seg3"></div>
                        <div class="strength-segment" id="seg4"></div>
                    </div>
                    <span class="strength-text" id="strengthText"></span>
                </div>
            </div>

            <div class="terms-checkbox">
                <input type="checkbox" id="terms" name="terms" required>
                <label for="terms">I agree to the <a href="{% url 'tos_privacy' %}">Terms of Service and Privacy Policy</a>.</label>
            </div>

            <button type="submit" class="btn-primary" id="submitBtn"><span class="btn-text">Create Account</span></button>
        </form>
        <div class="divider"><span>or sign up with</span></div>
        <div class="social-buttons"><button type="button" class="btn-social" onclick="socialLogin('Google')"><svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>Google</button><button type="button" class="btn-social" onclick="socialLogin('Apple')"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>Apple</button></div>
    </div></div>
    <div class="brand-panel"><div class="brand-content">
        <div class="brand-logo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg><span>BookSwap</span></div>
        <h2 class="brand-tagline">Join thousands of<br><span>smart families</span></h2>
        <p class="brand-description">Start saving money on school books today. Connect with your community and give books a second life.</p>
        <div class="features-list"><div class="feature-item"><div class="feature-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path><path d="M12 18V6"></path></svg></div><div class="feature-text"><h4>Save Money</h4><p>Get books at a fraction of the cost</p></div></div><div class="feature-item"><div class="feature-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m7 12 3 3 7-7"></path></svg></div><div class="feature-text"><h4>100% Free</h4><p>No fees, no subscriptions, ever</p></div></div><div class="feature-item"><div class="feature-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></div><div class="feature-text"><h4>Community Driven</h4><p>Connect with local families</p></div></div></div>
    </div></div>
    <div class="custom-toast-container" id="toastContainer"></div>
    <script>
        function togglePassword(){const p=document.getElementById('password'),e=document.getElementById('eyeIcon');if(p.type==='password'){p.type='text';e.innerHTML='<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>'}else{p.type='password';e.innerHTML='<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>'}}
        document.getElementById('password').addEventListener('input',function(){const pw=this.value,sd=document.getElementById('passwordStrength'),segs=[document.getElementById('seg1'),document.getElementById('seg2'),document.getElementById('seg3'),document.getElementById('seg4')],st=document.getElementById('strengthText');if(pw.length===0){sd.style.display='none';return}sd.style.display='block';let s=0;if(pw.length>=6)s++;if(pw.length>=10)s++;if(/[A-Z]/.test(pw)&&/[a-z]/.test(pw))s++;if(/[0-9]/.test(pw)||/[^A-Za-z0-9]/.test(pw))s++;const lvl=['Weak','Fair','Good','Strong'],cls=['weak','weak','medium','strong'];segs.forEach((seg,i)=>{seg.classList.remove('active','weak','medium','strong');if(i<s)seg.classList.add('active',cls[s-1])});st.textContent=lvl[s-1]||'Too short'});
        
        function showToast(m, t='success') {
            const c = document.getElementById('toastContainer');
            const d = document.createElement('div');
            d.className = `custom-toast ${t}`;
            
            let i = '';
            if (t === 'success') {
                // Checkmark
                i = '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>';
            } else if (t === 'error') { 
                // Orange Warning Triangle for "error"
                i = '<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line>';
            } else { 
                // Red X Circle for "critical"
                i = '<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>';
            }
            
            d.innerHTML = `<svg class="custom-toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">${i}</svg><span class="custom-toast-message">${m}</span>`;
            c.appendChild(d);
            setTimeout(() => {
                d.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => d.remove(), 300);
            }, 3000);
        }
        document.getElementById('signupForm').addEventListener('submit',function(e){
            const fn=document.getElementById('firstName').value.trim();
            const ln=document.getElementById('lastName').value.trim();
            const em=document.getElementById('email').value.trim();
            const pw=document.getElementById('password').value;
            const grade=document.getElementById('grade').value;
            const gradYear=document.getElementById('gradYear').value.trim();
            const tm=document.getElementById('terms').checked;
            const btn=document.getElementById('submitBtn');

            let invalid=false;
            if(!fn||!ln){showToast('Please enter your full name','error');invalid=true;}
            if(!em||!em.includes('@')){showToast('Please enter a valid email','error');invalid=true;}
            if(!grade){showToast('Select a valid grade','error');invalid=true;}
            if(!gradYear){showToast('Enter your graduation year','error');invalid=true;}
            if(pw.length<6){showToast('Password must be at least 6 characters','error');invalid=true;}
            if(!tm){showToast('Please accept the terms and conditions','error');invalid=true;}
            if(!em.toLowerCase().endsWith('@robcol.k12.tr')){showToast('Please use your school email (@robcol.k12.tr)','error');invalid=true;}
            if(invalid){e.preventDefault();return;}
            btn.classList.add('btn-loading'); // allow POST to Django
        });

        function socialLogin(p){showToast(`${p} signup coming soon!`,'critical')}

        {% if messages %}
        document.addEventListener('DOMContentLoaded', function() {
            {% for message in messages %}
                var tag = "{{ message.tags }}";
                if (tag.indexOf("critical") !== -1) {
                    showToast("{{ message|escapejs }}", "critical");
                } else if (tag.indexOf("error") !== -1 || tag.indexOf("warning") !== -1) {
                    showToast("{{ message|escapejs }}", "error");
                } else {
                    showToast("{{ message|escapejs }}", "success");
                }
            {% endfor %}
        });
        {% endif %}
    </script>
</body>
</html>